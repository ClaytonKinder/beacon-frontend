webpackJsonp([4,14],{478:function(e,t,n){function o(e){n(537)}var a=n(15)(n(539),n(540),o,"data-v-7da23f5c",null);e.exports=a.exports},490:function(e,t,n){function o(e){n(611)}var a=n(15)(n(613),n(614),o,null,null);e.exports=a.exports},513:function(e,t,n){var o=n(87),a=n(16)("toStringTag"),i="Arguments"==o(function(){return arguments}()),c=function(e,t){try{return e[t]}catch(e){}};e.exports=function(e){var t,n,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=c(t=Object(e),a))?n:i?o(t):"Object"==(s=o(t))&&"function"==typeof t.callee?"Arguments":s}},514:function(e,t,n){var o=n(32);e.exports=function(e,t,n,a){try{return a?t(o(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&o(i.call(e)),t}}},515:function(e,t,n){var o=n(48),a=n(16)("iterator"),i=Array.prototype;e.exports=function(e){return void 0!==e&&(o.Array===e||i[a]===e)}},516:function(e,t,n){var o=n(513),a=n(16)("iterator"),i=n(48);e.exports=n(47).getIteratorMethod=function(e){if(void 0!=e)return e[a]||e["@@iterator"]||i[o(e)]}},517:function(e,t,n){var o=n(16)("iterator"),a=!1;try{var i=[7][o]();i.return=function(){a=!0},Array.from(i,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!a)return!1;var n=!1;try{var i=[7],c=i[o]();c.next=function(){return{done:n=!0}},i[o]=function(){return c},e(i)}catch(e){}return n}},522:function(e,t,n){e.exports={default:n(523),__esModule:!0}},523:function(e,t,n){var o=n(47),a=o.JSON||(o.JSON={stringify:JSON.stringify});e.exports=function(e){return a.stringify.apply(a,arguments)}},524:function(e,t,n){"use strict";function o(e){var t,n;this.promise=new e(function(e,o){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=o}),this.resolve=a(t),this.reject=a(n)}var a=n(259);e.exports.f=function(e){return new o(e)}},529:function(e,t,n){var o=n(253),a=n(514),i=n(515),c=n(32),s=n(255),r=n(516),u={},l={},t=e.exports=function(e,t,n,d,f){var h,p,m,g,v=f?function(){return e}:r(e),b=o(n,d,t?2:1),_=0;if("function"!=typeof v)throw TypeError(e+" is not iterable!");if(i(v)){for(h=s(e.length);h>_;_++)if((g=t?b(c(p=e[_])[0],p[1]):b(e[_]))===u||g===l)return g}else for(m=v.call(e);!(p=m.next()).done;)if((g=a(m,b,p.value,t))===u||g===l)return g};t.BREAK=u,t.RETURN=l},530:function(e,t){e.exports=function(e,t,n,o){if(!(e instanceof t)||void 0!==o&&o in e)throw TypeError(n+": incorrect invocation!");return e}},531:function(e,t,n){var o=n(32),a=n(259),i=n(16)("species");e.exports=function(e,t){var n,c=o(e).constructor;return void 0===c||void 0==(n=o(c)[i])?t:a(n)}},532:function(e,t,n){var o,a,i,c=n(253),s=n(560),r=n(265),u=n(89),l=n(9),d=l.process,f=l.setImmediate,h=l.clearImmediate,p=l.MessageChannel,m=l.Dispatch,g=0,v={},b=function(){var e=+this;if(v.hasOwnProperty(e)){var t=v[e];delete v[e],t()}},_=function(e){b.call(e.data)};f&&h||(f=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return v[++g]=function(){s("function"==typeof e?e:Function(e),t)},o(g),g},h=function(e){delete v[e]},"process"==n(87)(d)?o=function(e){d.nextTick(c(b,e,1))}:m&&m.now?o=function(e){m.now(c(b,e,1))}:p?(a=new p,i=a.port2,a.port1.onmessage=_,o=c(i.postMessage,i,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(o=function(e){l.postMessage(e+"","*")},l.addEventListener("message",_,!1)):o="onreadystatechange"in u("script")?function(e){r.appendChild(u("script")).onreadystatechange=function(){r.removeChild(this),b.call(e)}}:function(e){setTimeout(c(b,e,1),0)}),e.exports={set:f,clear:h}},533:function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},534:function(e,t,n){var o=n(32),a=n(34),i=n(524);e.exports=function(e,t){if(o(e),a(t)&&t.constructor===e)return t;var n=i.f(e);return(0,n.resolve)(t),n.promise}},535:function(e,t,n){var o=n(18);e.exports=function(e,t,n){for(var a in t)n&&e[a]?e[a]=t[a]:o(e,a,t[a]);return e}},536:function(e,t,n){"use strict";var o=n(33);t.a={createConnectionRequest:function(e){return o.a.http.post("connection/createconnectionrequest",e)},cancelConnectionRequest:function(e){return o.a.http.post("connection/cancelconnectionrequest",e)},approveConnectionRequest:function(e){return o.a.http.post("connection/approveconnectionrequest",e)},denyConnectionRequest:function(e){return o.a.http.post("connection/denyconnectionrequest",e)},removeConnection:function(e){return o.a.http.post("connection/removeconnection",e)},disconnectFromBeacon:function(e){return o.a.http.post("connection/disconnectfrombeacon",e)},createConnectionObject:function(e,t,n){return{userId:t._id,beaconId:e._id,beaconOwnerId:e.author._id,lat:e.position.lat,lng:e.position.lng,userLat:n.lat,userLng:n.lng,ownerName:e.author.fullName,name:t.fullName,gravatar:t.gravatar,user:t}}}},537:function(e,t,n){var o=n(538);"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);n(476)("8e915d62",o,!0)},538:function(e,t,n){t=e.exports=n(475)(void 0),t.push([e.i,".connection-square[data-v-7da23f5c]{padding:1rem 1.5rem;color:#0c0c0c;transition:all .3s}.connection-square.map-modal[data-v-7da23f5c]{padding:0;font-size:.85rem}.connection-square[data-v-7da23f5c]:not(.map-modal){cursor:pointer}.connection-square[data-v-7da23f5c]:not(.map-modal):hover{background:#eee}.connection-square div.connection-name[data-v-7da23f5c]{text-overflow:ellipsis;max-width:100%;display:block;overflow:hidden}.connection-square span.connection-timestamp[data-v-7da23f5c]{color:#757575;font-size:90%;margin-top:.2rem}",""])},539:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"ConnectionSquare",props:["connection","mapModal"]}},540:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.connection?n("div",{staticClass:"connection-square text-center",class:{"map-modal":e.mapModal}},[n("img",{staticClass:"circular profile",attrs:{src:e.connection.gravatar}}),e._v(" "),n("div",{staticClass:"connection-name"},[e._v(e._s(e.connection.name))]),e._v(" "),e.mapModal?e._e():n("span",{staticClass:"connection-timestamp"},[e._v(e._s(e._f("moment")(e.connection.created,"from","now")))])]):e._e()},staticRenderFns:[]}},557:function(e,t,n){e.exports={default:n(558),__esModule:!0}},558:function(e,t,n){n(263),n(258),n(261),n(559),n(563),n(564),e.exports=n(47).Promise},559:function(e,t,n){"use strict";var o,a,i,c,s=n(50),r=n(9),u=n(253),l=n(513),d=n(86),f=n(34),h=n(259),p=n(530),m=n(529),g=n(531),v=n(532).set,b=n(561)(),_=n(524),y=n(533),C=n(534),w=r.TypeError,x=r.process,q=r.Promise,I="process"==l(x),$=function(){},B=a=_.f,M=!!function(){try{var e=q.resolve(1),t=(e.constructor={})[n(16)("species")]=function(e){e($,$)};return(I||"function"==typeof PromiseRejectionEvent)&&e.then($)instanceof t}catch(e){}}(),k=function(e){var t;return!(!f(e)||"function"!=typeof(t=e.then))&&t},O=function(e,t){if(!e._n){e._n=!0;var n=e._c;b(function(){for(var o=e._v,a=1==e._s,i=0;n.length>i;)!function(t){var n,i,c=a?t.ok:t.fail,s=t.resolve,r=t.reject,u=t.domain;try{c?(a||(2==e._h&&L(e),e._h=1),!0===c?n=o:(u&&u.enter(),n=c(o),u&&u.exit()),n===t.promise?r(w("Promise-chain cycle")):(i=k(n))?i.call(n,s,r):s(n)):r(o)}catch(e){r(e)}}(n[i++]);e._c=[],e._n=!1,t&&!e._h&&T(e)})}},T=function(e){v.call(r,function(){var t,n,o,a=e._v,i=P(e);if(i&&(t=y(function(){I?x.emit("unhandledRejection",a,e):(n=r.onunhandledrejection)?n({promise:e,reason:a}):(o=r.console)&&o.error&&o.error("Unhandled promise rejection",a)}),e._h=I||P(e)?2:1),e._a=void 0,i&&t.e)throw t.v})},P=function(e){if(1==e._h)return!1;for(var t,n=e._a||e._c,o=0;n.length>o;)if(t=n[o++],t.fail||!P(t.promise))return!1;return!0},L=function(e){v.call(r,function(){var t;I?x.emit("rejectionHandled",e):(t=r.onrejectionhandled)&&t({promise:e,reason:e._v})})},R=function(e){var t=this;t._d||(t._d=!0,t=t._w||t,t._v=e,t._s=2,t._a||(t._a=t._c.slice()),O(t,!0))},j=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw w("Promise can't be resolved itself");(t=k(e))?b(function(){var o={_w:n,_d:!1};try{t.call(e,u(j,o,1),u(R,o,1))}catch(e){R.call(o,e)}}):(n._v=e,n._s=1,O(n,!1))}catch(e){R.call({_w:n,_d:!1},e)}}};M||(q=function(e){p(this,q,"Promise","_h"),h(e),o.call(this);try{e(u(j,this,1),u(R,this,1))}catch(e){R.call(this,e)}},o=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},o.prototype=n(535)(q.prototype,{then:function(e,t){var n=B(g(this,q));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=I?x.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&O(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new o;this.promise=e,this.resolve=u(j,e,1),this.reject=u(R,e,1)},_.f=B=function(e){return e===q||e===c?new i(e):a(e)}),d(d.G+d.W+d.F*!M,{Promise:q}),n(49)(q,"Promise"),n(562)("Promise"),c=n(47).Promise,d(d.S+d.F*!M,"Promise",{reject:function(e){var t=B(this);return(0,t.reject)(e),t.promise}}),d(d.S+d.F*(s||!M),"Promise",{resolve:function(e){return C(s&&this===c?q:this,e)}}),d(d.S+d.F*!(M&&n(517)(function(e){q.all(e).catch($)})),"Promise",{all:function(e){var t=this,n=B(t),o=n.resolve,a=n.reject,i=y(function(){var n=[],i=0,c=1;m(e,!1,function(e){var s=i++,r=!1;n.push(void 0),c++,t.resolve(e).then(function(e){r||(r=!0,n[s]=e,--c||o(n))},a)}),--c||o(n)});return i.e&&a(i.v),n.promise},race:function(e){var t=this,n=B(t),o=n.reject,a=y(function(){m(e,!1,function(e){t.resolve(e).then(n.resolve,o)})});return a.e&&o(a.v),n.promise}})},560:function(e,t){e.exports=function(e,t,n){var o=void 0===n;switch(t.length){case 0:return o?e():e.call(n);case 1:return o?e(t[0]):e.call(n,t[0]);case 2:return o?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return o?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return o?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},561:function(e,t,n){var o=n(9),a=n(532).set,i=o.MutationObserver||o.WebKitMutationObserver,c=o.process,s=o.Promise,r="process"==n(87)(c);e.exports=function(){var e,t,n,u=function(){var o,a;for(r&&(o=c.domain)&&o.exit();e;){a=e.fn,e=e.next;try{a()}catch(o){throw e?n():t=void 0,o}}t=void 0,o&&o.enter()};if(r)n=function(){c.nextTick(u)};else if(i){var l=!0,d=document.createTextNode("");new i(u).observe(d,{characterData:!0}),n=function(){d.data=l=!l}}else if(s&&s.resolve){var f=s.resolve();n=function(){f.then(u)}}else n=function(){a.call(o,u)};return function(o){var a={fn:o,next:void 0};t&&(t.next=a),e||(e=a,n()),t=a}}},562:function(e,t,n){"use strict";var o=n(9),a=n(47),i=n(17),c=n(19),s=n(16)("species");e.exports=function(e){var t="function"==typeof a[e]?a[e]:o[e];c&&t&&!t[s]&&i.f(t,s,{configurable:!0,get:function(){return this}})}},563:function(e,t,n){"use strict";var o=n(86),a=n(47),i=n(9),c=n(531),s=n(534);o(o.P+o.R,"Promise",{finally:function(e){var t=c(this,a.Promise||i.Promise),n="function"==typeof e;return this.then(n?function(n){return s(t,e()).then(function(){return n})}:e,n?function(n){return s(t,e()).then(function(){throw n})}:e)}})},564:function(e,t,n){"use strict";var o=n(86),a=n(524),i=n(533);o(o.S,"Promise",{try:function(e){var t=a.f(this),n=i(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},567:function(e,t,n){"use strict";var o=n(33);t.a={getCurrentPosition:function(){return o.a.http.post("https://www.googleapis.com/geolocation/v1/geolocate?key=AIzaSyDB7lZd5FSWzgoGMMwnMEVmHPAUeor69MM")},getBeaconDistance:function(e){return o.a.http.post("location/getbeacondistance",e)},createBeaconDistanceObject:function(e,t){return{beaconLat:e.position.lat,beaconLng:e.position.lng,userLat:t.lat,userLng:t.lng}}}},568:function(e,t,n){"use strict";var o=n(33);t.a={lightBeacon:function(e){return o.a.http.post("beacon/lightbeacon",e)},extinguishBeacon:function(e){return o.a.http.post("beacon/extinguishbeacon",e)},getNearbyBeacons:function(e){return o.a.http.post("beacon/getnearbybeacons",e)},verifyBeaconPassword:function(e){return o.a.http.post("beacon/verifybeaconpassword",e)}}},611:function(e,t,n){var o=n(612);"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);n(476)("457a5142",o,!0)},612:function(e,t,n){t=e.exports=n(475)(void 0),t.push([e.i,".beaconMap{width:100%;height:400px}.map-modal .beacon-name{padding-top:1rem}.map-modal .beacon-tags,.map-modal .beacon-tags .beacon-tag{margin-bottom:.5rem}.map-modal .beacon-password-form{display:inline-block}.map-modal .connections-carousel{height:110px}.map-modal .connections-carousel .q-carousel-track{height:auto}.map-modal .connections-carousel .q-carousel-track>div{padding:0;min-height:0}.map-footer{height:50px;padding:0}.map-footer .q-btn{-webkit-box-flex:1;-ms-flex:1;flex:1;height:100%}",""])},613:function(e,t,n){"use strict";function o(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}Object.defineProperty(t,"__esModule",{value:!0});var a=n(557),i=n.n(a),c=n(522),s=n.n(c),r=n(46),u=n(568),l=n(254),d=n(257),f=n(567),h=n(536),p=n(478),m=n.n(p);t.default={name:"map",mixins:[l.a,d.a],components:{QWindowResizeObservable:r.Q,QModal:r.z,QModalLayout:r.A,QInput:r.q,QBtn:r.d,QIcon:r.o,QToolbar:r.O,QToolbarTitle:r.P,QChip:r.j,QTabs:r.M,QTab:r.K,QInnerLoading:r.p,QSpinnerGears:r.J,QCarousel:r.i,ConnectionSquare:m.a},data:function(){return{loading:!1,modalLoading:!1,distanceInfo:null,connectionErrors:[],beaconPassword:null,modalOpen:!1,mapOptions:{lat:0,lng:0,unitOfMeasurement:this.$store.state.user.settings.unitOfMeasurement||"miles",searchRadius:this.$store.state.user.settings.searchRadius||15,beaconLimit:this.$store.state.user.settings.beaconLimit||50,zoom:13,user:this.$store.state.user||{}},selectedBeacon:null,markers:null,mapHeight:"400px",currentPosition:{lng:null,lat:null},controlOptions:{zoomControl:!1,streetViewControl:!1,mapTypeControl:!1,fullscreenControl:!1}}},computed:{chunkedConnections:function(){if(this.selectedBeacon&&this.selectedBeacon.connections.length){for(var e=JSON.parse(s()(this.selectedBeacon.connections)),t=[];e.length>0;)t.push(e.splice(0,3));return t}return[]}},methods:{showButtons:function(e){return"connect"===e?!this.selectedBeacon.additionalSettings.password&&this.distanceInfo&&this.distanceInfo.canConnect&&this.$store.state.user.outgoingConnectionRequest.beaconId!==this.selectedBeacon._id&&this.$store.state.user.connectedTo.beaconId!==this.selectedBeacon._id&&!this.$store.state.user.beacon:"connect-password"===e?this.selectedBeacon.additionalSettings.password&&this.distanceInfo&&this.distanceInfo.canConnect&&this.$store.state.user.outgoingConnectionRequest.beaconId!==this.selectedBeacon._id&&this.$store.state.user.connectedTo.beaconId!==this.selectedBeacon._id&&!this.$store.state.user.beacon:"cancel-request"===e?this.$store.state.user.outgoingConnectionRequest.beaconId===this.selectedBeacon._id:"disconnect"===e?this.$store.state.user.connectedTo.beaconId===this.selectedBeacon._id:"extinguish"===e?this.$store.state.user.beacon&&this.$store.state.user.beacon._id===this.selectedBeacon._id:void 0},verifyBeaconPassword:function(){var e=this;this.modalLoading=!0;var t={beaconId:this.selectedBeacon._id,password:this.beaconPassword};u.a.verifyBeaconPassword(t).then(function(t){e.modalLoading=!1,t.body?e.createConnectionRequest(e.selectedBeacon):e.createToast("negative","Incorrect password")}).catch(function(t){e.modalLoading=!1,e.createToast("negative",t.body.message)})},disconnectFromBeacon:function(e){var t=this;this.modalLoading=!0,e.userId=this.$store.state.user._id,e.beaconId||(e.beaconId=e._id),h.a.disconnectFromBeacon(e).then(function(n){t.modalLoading=!1,t.$store.commit("updateUser",n.body);var o={toId:e.author._id,fromId:e.userId,fromName:e.name};t.$socket.emit("disconnectFromBeacon",o),t.$refs.mapModal.close()}).catch(function(e){t.modalLoading=!1,t.createToast("negative",e.body.message)})},extinguishBeacon:function(){var e=this;this.modalLoading=!0;var t=JSON.parse(s()(this.$store.state.user.beacon)),n={beaconId:t._id,userId:t.author};u.a.extinguishBeacon(n).then(function(n){e.modalLoading=!1,e.$store.commit("extinguishBeacon"),e.$store.commit("updateUser",n.body);var o={toIds:t.connections.map(function(e){return e.userId}),fromId:t.author,fromName:e.$store.state.user.fullName};e.$socket.emit("extinguishBeacon",o),e.loadMap(),e.$refs.mapModal.close()}).catch(function(t){e.beaconLit=!e.beaconLit,e.modalLoading=!1,e.createToast("negative",t.body.message)})},checkConnectionErrors:function(e,t){this.connectionErrors=[],t.canConnect||this.connectionErrors.push("You are not close enough to connect")},setMapCenter:function(e,t){var n=this.$store.state.user;this.doesObjectExist(n.beacon)&&!this.doesObjectExist(n.connectedTo)?(this.mapOptions.lng=n.beacon.location.coordinates[0],this.mapOptions.lat=n.beacon.location.coordinates[1]):this.doesObjectExist(n.connectedTo)&&!this.doesObjectExist(n.beacon)?(this.mapOptions.lng=n.connectedTo.lng,this.mapOptions.lat=n.connectedTo.lat):(this.mapOptions.lng=e,this.mapOptions.lat=t)},centerMap:function(){var e=new google.maps.LatLng(this.mapOptions.lat,this.mapOptions.lng);this.$refs.beaconMap.panTo(e)},getBeaconThemeColor:function(e){return e.additionalSettings.password?"secondary":"primary"},openMapModal:function(e){var t=this;this.modalLoading=!0,this.selectedBeacon=e,this.modalOpen=!0,this.$refs.connectionCarousel&&this.$refs.connectionCarousel.goToSlide(0),f.a.getBeaconDistance(f.a.createBeaconDistanceObject(e,this.currentPosition)).then(function(n){t.modalLoading=!1,t.distanceInfo=n.body,t.checkConnectionErrors(e,t.distanceInfo)}).catch(function(e){t.modalLoading=!1,t.$refs.mapModal.close(),t.createToast("negative",e.body.message)})},closeMapModal:function(){this.modalOpen=!1,this.$refs.mapModal.close()},createConnectionRequest:function(e){var t=this;this.modalLoading=!0;var n=h.a.createConnectionObject(e,this.$store.state.user,this.currentPosition);if(this.doesObjectExist(this.$store.state.user.outgoingConnectionRequest)&&this.$store.state.user.outgoingConnectionRequest.beaconId!==e.beaconId){var o=JSON.parse(s()(this.$store.state.user.outgoingConnectionRequest));h.a.cancelConnectionRequest(this.$store.state.user.outgoingConnectionRequest).then(function(e){var a={toId:o.beaconOwnerId,fromId:o.userId,fromName:o.name};t.$socket.emit("cancelConnectionRequest",a),h.a.createConnectionRequest(n).then(function(e){t.modalLoading=!1,t.$store.commit("updateUser",e.body),t.createToast("positive","Your connection request has been sent successfully");var n={toId:e.body.outgoingConnectionRequest.beaconOwnerId,fromId:e.body.outgoingConnectionRequest.userId,fromName:e.body.outgoingConnectionRequest.name};t.$socket.emit("createConnectionRequest",n),t.$refs.mapModal.close()}).catch(function(e){t.modalLoading=!1,t.createToast("negative",e.body.message)})}).catch(function(e){t.createToast("negative",e.body.message)})}else this.doesObjectExist(this.$store.state.user.connectedTo)&&this.$store.state.user.connectedTo.beaconId!==e.beaconId?h.a.disconnectFromBeacon(this.$store.state.user.connectedTo).then(function(o){t.modalLoading=!1,t.$store.commit("updateUser",o.body);var a={toId:e.author._id,fromId:e.userId,fromName:e.name};t.$socket.emit("disconnectFromBeacon",a),h.a.createConnectionRequest(n).then(function(e){t.modalLoading=!1,t.$store.commit("updateUser",e.body),t.createToast("positive","Your connection request has been sent successfully");var n={toId:e.body.outgoingConnectionRequest.beaconOwnerId,fromId:e.body.outgoingConnectionRequest.userId,fromName:e.body.outgoingConnectionRequest.name};t.$socket.emit("createConnectionRequest",n),t.$refs.mapModal.close()}).catch(function(e){t.modalLoading=!1,t.createToast("negative",e.body.message)})}).catch(function(e){t.modalLoading=!1,t.createToast("negative",e.body.message)}):h.a.createConnectionRequest(n).then(function(e){t.modalLoading=!1,t.$refs.mapModal.close(),t.$store.commit("updateUser",e.body),t.createToast("positive","Your connection request has been sent successfully");var n={toId:e.body.outgoingConnectionRequest.beaconOwnerId,fromId:e.body.outgoingConnectionRequest.userId,fromName:e.body.outgoingConnectionRequest.name};t.$socket.emit("createConnectionRequest",n)}).catch(function(e){t.modalLoading=!1,t.createToast("negative",e.body.message)})},cancelConnectionRequest:function(e){var t=this;this.modalLoading=!0,h.a.cancelConnectionRequest(e).then(function(n){t.modalLoading=!1,t.$store.commit("updateUser",n.body);var o={toId:e.beaconOwnerId,fromId:e.userId,fromName:e.name};t.$socket.emit("cancelConnectionRequest",o),t.$refs.mapModal.close()}).catch(function(e){t.modalLoading=!1,t.createToast("negative",e.body.message)})},checkLightOrDarkText:function(){var e=o(this.selectedBeacon.color),t=[e[0]/255,e[1]/255,e[2]/255];return t.forEach(function(e){e<=.03928?e/=12.92:e=Math.pow((e+.055)/1.055,2.4)}),.2126*t[0]+.7152*t[1]+.0722*t[2]>.179?"#0C0C0C":"#FFF"},updateMapHeight:function(){var e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;this.mapHeight=e-122-50+"px",this.$refs.beaconMap.resizePreserveCenter()},generateMarkerSize:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:21,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:34,o=1;return e>0&&e<=10?o=1.05:e>10&&e<=25?o=1.15:e>25&&e<=100?o=1.25:e>100&&(o=1.35),new google.maps.Size(t*o,n*o)},getCurrentLocation:function(){return new i.a(function(e,t){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){e({body:{accuracy:t.coords.accuracy,location:{lat:t.coords.latitude,lng:t.coords.longitude}}})},function(n){var o="";o=1===n.code?"It is HIGHLY recommended to allow your browser to access geolocation. If you choose not to allow access, your location will be far less accurate. Access to geolocation can be changed at any time in your browser settings.":"We were unable to get your location through geolocation. Your location will be less accurate because of this.",r.c.create({title:"Warning",message:o,buttons:[{label:"Confirm",handler:function(){f.a.getCurrentPosition().then(function(t){e(t)}).catch(function(e){t(e)})}}]})},{enableHighAccuracy:!0}):f.a.getCurrentPosition().then(function(t){e(t)}).catch(function(e){t(e)})})},loadMap:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=this||e;o.loading=!0,this.getCurrentLocation().then(function(e){o.setMapCenter(e.body.location.lng,e.body.location.lat),o.currentPosition.lng=o.mapOptions.lng,o.currentPosition.lat=o.mapOptions.lat,u.a.getNearbyBeacons(o.mapOptions).then(function(e){var t=new google.maps.LatLngBounds;if(e.body.length?(e.body.map(function(e){var n={lng:e.location.coordinates[0],lat:e.location.coordinates[1]},a={url:"https://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|"+e.color.replace(/^#/,""),scaledSize:o.generateMarkerSize(e.connections.length),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(10,34)};e.icon=a,e.opacity=e.author._id===o.$store.state.user._id?.3:1,e.zIndex=e.author._id===o.$store.state.user._id?10:1,e.title=e.author._id===o.$store.state.user._id?"Your beacon":e.author.firstName,t.extend(n),e.position=n}),o.markers=e.body):(o.createToast("negative","There are no beacons around you at this time"),t.extend(o.currentPosition)),n&&o.$refs.beaconMap.fitBounds(t),!o.doesObjectExist(o.$store.state.user.beacon)&&!o.doesObjectExist(o.$store.state.user.connectedTo)){var a="female"===o.$store.state.user.gender?"femaleMapMarker":"maleMapMarker";o.markers||(o.markers=[]),o.markers.push({position:{lng:o.mapOptions.lng,lat:o.mapOptions.lat},icon:"https://ck-beacon-frontend.herokuapp.com/assets/images/"+a+".png",opacity:.5,zIndex:10,title:"You"})}o.loading=!1}).catch(function(){o.loading=!1,o.createToast("negative","Could not populate map at this time")})}).catch(function(){o.loading=!1,t.createToast("negative","Could not populate map at this time")})}},mounted:function(){var e=this;this.$q.events.$on("emitResizeMap",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300;e.$refs.beaconMap&&setTimeout(e.$refs.beaconMap.resizePreserveCenter,t)}),this.loadMap(this)}}},614:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"relative-position"},[n("q-window-resize-observable",{on:{resize:e.updateMapHeight}}),e._v(" "),n("gmap-map",{ref:"beaconMap",staticClass:"beaconMap",style:{height:e.mapHeight},attrs:{center:e.mapOptions,zoom:13,options:e.controlOptions,"map-type-id":"terrain"}},e._l(e.markers,function(t,o){return n("gmap-marker",{key:o,attrs:{icon:t.icon,opacity:t.opacity,zIndex:t.zIndex,title:t.title,position:t.position,clickable:!0},on:{click:function(n){e.openMapModal(t)}}})})),e._v(" "),n("q-modal",{ref:"mapModal",staticClass:"relative-position map-modal mobile-modal-padding footer-no-shadow",attrs:{"content-css":{minWidth:"400px",minHeight:"400px"}},model:{value:e.modalOpen,callback:function(t){e.modalOpen=t},expression:"modalOpen"}},[e.selectedBeacon?n("q-modal-layout",[n("q-toolbar",{style:{background:e.selectedBeacon.color},slot:"header"},[n("div",{staticClass:"q-toolbar-title row justify-start align-center"},[n("img",{staticClass:"circular profile on-left",attrs:{src:e.selectedBeacon.author.gravatar}}),e._v(" "),n("div",{staticClass:"modal-header-name row items-center",style:{color:e.checkLightOrDarkText()}},[e._v("\n            "+e._s(e.selectedBeacon.author.firstName)+"\n          ")])])]),e._v(" "),n("h6",{staticClass:"text-center beacon-name"},[e._v(e._s(e.selectedBeacon.name))]),e._v(" "),n("div",{staticClass:"modal-body"},[n("div",[n("p",[e._v(e._s(e.selectedBeacon.description))])]),e._v(" "),n("div",{staticClass:"beacon-tags"},e._l(e.selectedBeacon.additionalSettings.tags,function(t){return n("q-chip",{key:t,staticClass:"beacon-tag on-left",attrs:{color:e.getBeaconThemeColor(e.selectedBeacon),small:""}},[e._v("\n            "+e._s(t)+"\n          ")])})),e._v(" "),e.connectionErrors.length?n("div",e._l(e.connectionErrors,function(t,o){return n("div",{key:o,staticClass:"info-block negative"},[n("q-icon",{attrs:{name:"fa-exclamation-circle"}}),e._v(" "),n("div",{attrs:{color:"negative"}},[e._v(e._s(t))])],1)})):e._e(),e._v(" "),n("div",[e.chunkedConnections.length<2?n("div",e._l(e.chunkedConnections,function(t,o){return n("div",{key:o,staticClass:"row"},e._l(e.chunkedConnections[o],function(e){return n("connection-square",{key:"connection.userId",staticClass:"col col-xs-4",attrs:{"map-modal":!0,connection:e}})}))})):e._e(),e._v(" "),e.chunkedConnections.length>=2?n("q-carousel",{ref:"connectionCarousel",staticClass:"connections-carousel",attrs:{dots:""}},e._l(e.chunkedConnections,function(t,o){return n("div",{key:o,staticClass:"row",slot:"slide"},e._l(e.chunkedConnections[o],function(e){return n("connection-square",{key:"connection.userId",staticClass:"col col-xs-4",attrs:{"map-modal":!0,connection:e}})}))})):e._e()],1)]),e._v(" "),n("q-toolbar",{staticClass:"bg-white",slot:"footer"},[n("div",{staticClass:"q-toolbar-title text-right"},[n("q-btn",{attrs:{flat:"",color:"primary"},on:{click:e.closeMapModal}},[e._v("Close")]),e._v(" "),e.showButtons("connect")?n("q-btn",{attrs:{color:"primary"},on:{click:function(t){e.createConnectionRequest(e.selectedBeacon)}}},[e._v("\n          Connect\n          ")]):e._e(),e._v(" "),e.showButtons("connect-password")?n("form",{ref:"beaconPasswordForm",staticClass:"beacon-password-form",on:{submit:function(t){t.preventDefault(),e.verifyBeaconPassword(t)}}},[n("q-input",{attrs:{"max-length":"50",type:"password",color:"secondary",placeholder:"Enter beacon password",inverted:"",after:[{icon:"arrow_forward",handler:e.verifyBeaconPassword}]},model:{value:e.beaconPassword,callback:function(t){e.beaconPassword=t},expression:"beaconPassword"}})],1):e._e(),e._v(" "),e.showButtons("cancel-request")?n("q-btn",{attrs:{color:"negative"},on:{click:function(t){e.cancelConnectionRequest(e.$store.state.user.outgoingConnectionRequest)}}},[e._v("\n          Cancel connection request\n          ")]):e._e(),e._v(" "),e.showButtons("disconnect")?n("q-btn",{attrs:{color:"negative"},on:{click:function(t){e.disconnectFromBeacon(e.selectedBeacon)}}},[e._v("\n          Disconnect\n          ")]):e._e(),e._v(" "),e.showButtons("extinguish")?n("q-btn",{attrs:{color:"negative"},on:{click:function(t){e.extinguishBeacon(e.selectedBeacon)}}},[e._v("\n          Extinguish\n          ")]):e._e()],1)])],1):e._e(),e._v(" "),n("q-inner-loading",{staticClass:"modal-inner-loading",attrs:{visible:e.modalLoading}},[n("q-spinner-gears",{attrs:{size:"50px",color:"primary"}})],1)],1),e._v(" "),n("q-toolbar",{staticClass:"map-footer row justify-center items-center"},[n("q-btn",{staticClass:"icon-button",attrs:{flat:"",icon:"my_location"},on:{click:function(t){t.preventDefault(),e.centerMap()}}}),e._v(" "),n("q-btn",{staticClass:"icon-button",attrs:{flat:"",icon:"ion-refresh"},on:{click:function(t){t.preventDefault(),e.loadMap(null,!1)}}})],1),e._v(" "),n("q-inner-loading",{attrs:{visible:e.loading}},[n("q-spinner-gears",{attrs:{size:"50px",color:"primary"}})],1)],1)},staticRenderFns:[]}}});